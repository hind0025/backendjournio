<!DOCTYPE html>
<html>

<head>
   <title>Login | Sign Up</title>
   <link rel="stylesheet" type="text/css" href="style.css">
   <link href="https://fonts.googleapis.com/css2?family=Jost:wght@500&display=swap" rel="stylesheet">
   <style>
      .notification {
         position: fixed;
         top: 20px;
         right: 20px;
         background-color: #4caf50;
         color: white;
         padding: 10px 20px;
         border-radius: 5px;
         box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
         opacity: 0;
         visibility: hidden;
         transition: opacity 0.3s ease, visibility 0.3s ease;
      }

      .notification.error {
         background-color: #f44336;
      }

      .notification.show {
         opacity: 1;
         visibility: visible;
      }
   </style>
</head>

<body>
   <div class="main">
      <input type="checkbox" id="chk" aria-hidden="true">

      <div class="signup">
         <form id="signupForm" method="POST">
            <input type="text" name="username" placeholder="User name" required>
            <input type="email" name="email" placeholder="Email" required>
            <input type="text" name="phoneNumber" placeholder="Phone Number" required>
            <input type="password" name="password" placeholder="Password" required>
            <button type="submit">Sign up</button>
         </form>
      </div>

      <div class="login">
         <form id="loginForm" method="POST">
            <label for="chk" aria-hidden="true">Login</label>
            <input type="email" name="email" placeholder="Email" required>
            <input type="password" name="password" placeholder="Password" required>
            <button type="submit">Login</button>
         </form>
      </div>
   </div>

   <!-- Notification -->
   <div id="notification" class="notification">Login Successful!</div>

   <script>
      const loginForm = document.getElementById('loginForm');
      const signupForm = document.getElementById('signupForm');
      const notification = document.getElementById('notification');

      // Handle Login Form Submission
      loginForm.addEventListener('submit', async (e) => {
         e.preventDefault(); // Prevent default form submission

         const formData = new FormData(loginForm);
         const data = Object.fromEntries(formData.entries());

         try {
            const response = await fetch('http://127.0.0.1:5000/api/auth/login', {
               method: 'POST',
               headers: {
                  'Content-Type': 'application/json',
               },
               body: JSON.stringify(data),
            });

            if (response.ok) {
               // Show success notification
               notification.textContent = 'Login Successful!';
               notification.classList.add('show');

               // Redirect to Home after 2 seconds
               setTimeout(() => {
                  notification.classList.remove('show');
                  window.location.href = '/Backend-JOURNIO/Public/Journio/index.html'; // Update with your Home page URL
               }, 2000);
            } else {
               const errorData = await response.json();
               showErrorNotification(errorData.error || 'Login failed!');
            }
         } catch (error) {
            console.error('Login error:', error);
            showErrorNotification('Something went wrong. Please try again.');
         }
      });

      // Handle Sign-Up Form Submission
      signupForm.addEventListener('submit', async (e) => {
         e.preventDefault(); // Prevent default form submission

         const formData = new FormData(signupForm);
         const data = Object.fromEntries(formData.entries());

         try {
            const response = await fetch('http://127.0.0.1:5000/api/auth/signup', {
               method: 'POST',
               headers: {
                  'Content-Type': 'application/json',
               },
               body: JSON.stringify(data),
            });

            if (response.ok) {
               // Show success notification
               notification.textContent = 'Sign-Up Successful!';
               notification.classList.add('show');

               // Redirect to Home after 2 seconds
               setTimeout(() => {
                  notification.classList.remove('show');
                  window.location.href = '/Backend-JOURNIO/Public/Journio/index.html'; // Update with your Home page URL
               }, 2000);
            } else {
               const errorData = await response.json();
               showErrorNotification(errorData.error || 'Sign-Up failed!');
            }
         } catch (error) {
            console.error('Sign-Up error:', error);
            showErrorNotification('Something went wrong. Please try again.');
         }
      });

      // Function to Show Error Notification
      function showErrorNotification(message) {
         notification.textContent = message;
         notification.classList.add('show', 'error');
         setTimeout(() => {
            notification.classList.remove('show', 'error');
         }, 3000);
      }
   </script>
</body>

</html>
